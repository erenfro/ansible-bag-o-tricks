#!/bin/bash

function grep_challenge_limit() {
    # emit current state of net.ipv4.tcp_challenge_ack_limit.
    sysctl -a | grep "net.ipv4.tcp_challenge_ack_limit"
}

function clean_sysctl_of_bandaid() {
    # remove the tcp_challenge_ack_limit and CVE comment if present..
    cp /etc/sysctl.conf /etc/sysctl.conf.bak
    grep -E -v 'net.ipv4.tcp_challenge_ack_limit|CVE-2016-5696' /etc/sysctl.conf.bak > /etc/sysctl.conf
}

grep_challenge_limit

clean_sysctl_of_bandaid

# roll back bandaid to 100.
echo 'net.ipv4.tcp_challenge_ack_limit = 100' >> /etc/sysctl.conf

# have sysctl reload its config.
sysctl -p

clean_sysctl_of_bandaid

grep_challenge_limit
