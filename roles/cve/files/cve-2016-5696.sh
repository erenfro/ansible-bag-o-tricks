#!/bin/bash

function grep_challenge_limit() {
    # emit current state of net.ipv4.tcp_challenge_ack_limit.
    sysctl -a | grep "net.ipv4.tcp_challenge_ack_limit"
}

grep_challenge_limit

# remove the non-max limit and CVE comment if present..
cp /etc/sysctl.conf /etc/sysctl.conf.bak
grep -E -v 'net.ipv4.tcp_challenge_ack_limit|CVE-2016-5696' /etc/sysctl.conf.bak > /etc/sysctl.conf

# add the bandaid.
echo '# temporary bandaid for CVE-2016-5696' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_challenge_ack_limit = 999999999' >> /etc/sysctl.conf

# have sysctl reload its config.
sysctl -p

grep_challenge_limit
